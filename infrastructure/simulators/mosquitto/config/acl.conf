# ============================================
# Mosquitto ACL Configuration
# Aquaculture Platform - Topic Access Control
# ============================================
#
# Topic Patterns:
#   %u = username (mqtt_client_id for edge devices)
#   %c = client ID
#
# Access Types:
#   read, write, readwrite, deny
#
# Pattern Matching:
#   + = single level wildcard
#   # = multi-level wildcard
# ============================================

# ============================================
# Backend Services - Full Access
# ============================================
# Backend services use the 'backend_service' user
# with full read/write access to all topics
user backend_service
topic readwrite #

# Sensor service for data ingestion
user sensor_service
topic readwrite #

# Alert engine for monitoring
user alert_service
topic read sensor/#
topic read edge/#
topic write alerts/#

# ============================================
# Edge Device Access Rules (v1.1)
# ============================================
# Each edge device has its own mqtt_client_id as username
# Format: edge-{tenantId:8}-{deviceCode}
# Example: edge-4b529829-RPI-A1B2C3D4
#
# Topic Format (v1.1): tenants/{tenant_id}/devices/{device_id}/*
# %u = device mqtt_client_id (used as device identifier in topics)

# Pattern-based rules for edge devices - tenant-prefixed topics
# Main pattern: devices can read/write their own topics under any tenant
pattern readwrite tenants/+/devices/%u/#

# Devices can publish status/telemetry to their namespace
pattern write tenants/+/devices/%u/status
pattern write tenants/+/devices/%u/telemetry
pattern write tenants/+/devices/%u/responses

# Devices can read commands and config from their namespace
pattern read tenants/+/devices/%u/commands
pattern read tenants/+/devices/%u/config

# Legacy support (deprecated - will be removed)
pattern readwrite edge/%u/#

# ============================================
# Sensor Data Topics (Legacy Support)
# ============================================
# Allow anonymous users to publish sensor data (for simulators)
topic readwrite sensor/#
topic readwrite sensors/#

# ============================================
# System Topics
# ============================================
# $SYS topics are read-only for monitoring
topic read $SYS/#

# ============================================
# Development/Debug Topics
# ============================================
# Allow all users to access test topics
topic readwrite test/#
topic readwrite debug/#

# ============================================
# Anonymous User Access (Development Only)
# ============================================
# In production, remove or restrict these rules
user anonymous
topic readwrite sensor/#
topic readwrite sensors/#
topic readwrite test/#
topic read edge/+/status

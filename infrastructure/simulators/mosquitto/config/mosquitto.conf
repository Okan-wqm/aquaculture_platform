# ============================================
# Mosquitto MQTT Broker Configuration
# Aquaculture Platform - Edge Device Support
# ============================================

# ============================================
# TCP Listener (standard MQTT port 1883)
# ============================================
listener 1883

# ============================================
# WebSocket Listener (port 9001)
# For browser-based clients
# ============================================
listener 9001
protocol websockets

# ============================================
# Authentication Configuration
# ============================================
# Allow anonymous connections for development
# In production, set to false and use password_file
allow_anonymous true

# Password file for device authentication
# Format: username:password_hash (PBKDF2-SHA512)
# Generate with: mosquitto_passwd -c /mosquitto/config/passwd username
password_file /mosquitto/config/passwd

# ACL file for topic access control
acl_file /mosquitto/config/acl.conf

# ============================================
# Persistence Configuration
# ============================================
persistence true
persistence_location /mosquitto/data/
autosave_interval 60

# ============================================
# Logging Configuration
# ============================================
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
log_type subscribe
log_type unsubscribe
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# ============================================
# Connection Settings
# ============================================
max_connections -1
max_queued_messages 1000
max_inflight_messages 20

# Keep-alive settings
max_keepalive 300

# ============================================
# Security Settings
# ============================================
# Disable $SYS topic for non-admin users (controlled via ACL)
# sys_interval 10

# Require clients to provide a client ID
# (Disabled for development - edge agents provide their own)
# require_certificate false
